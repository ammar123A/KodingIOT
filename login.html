<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - KodingIoT</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <div class="auth-header">
                <h1>ğŸš€ KodingIoT</h1>
                <p>Log masuk ke akaun anda</p>
            </div>

            <form id="loginForm" class="auth-form">
                <div class="form-group">
                    <label for="username">ğŸ‘¤ Nama Pengguna</label>
                    <input type="text" id="username" name="username" required>
                </div>

                <div class="form-group">
                    <label for="password">ğŸ”’ Kata Laluan</label>
                    <input type="password" id="password" name="password" required>
                </div>

                <button type="submit" class="auth-btn">Log Masuk</button>
            </form>

            <div class="auth-footer">
                <p>Belum ada akaun? <a href="#" id="switchToRegister">Daftar di sini</a></p>
            </div>
        </div>

        <div class="auth-card" id="registerCard" style="display: none;">
            <div class="auth-header">
                <h1>ğŸš€ KodingIoT</h1>
                <p>Buat akaun baharu</p>
            </div>

            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="regUsername">ğŸ‘¤ Nama Pengguna</label>
                    <input type="text" id="regUsername" name="username" required>
                </div>

                <div class="form-group">
                    <label for="regEmail">ğŸ“§ E-mel</label>
                    <input type="email" id="regEmail" name="email" required>
                </div>

                <div class="form-group">
                    <label for="regPassword">ğŸ”’ Kata Laluan</label>
                    <input type="password" id="regPassword" name="password" required>
                </div>

                <div class="form-group">
                    <label for="regConfirmPassword">ğŸ”’ Sahkan Kata Laluan</label>
                    <input type="password" id="regConfirmPassword" name="confirmPassword" required>
                </div>

                <button type="submit" class="auth-btn">Daftar</button>
            </form>

            <div class="auth-footer">
                <p>Sudah ada akaun? <a href="#" id="switchToLogin">Log masuk di sini</a></p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/api-client.js"></script>
    <script src="js/auth.js"></script>
    <script>
    // Show session-expired message if redirected
    (function() {
        if (new URLSearchParams(window.location.search).get('expired') === '1') {
            const msg = document.createElement('div');
            msg.className = 'auth-message error';
            msg.textContent = 'â³ Sesi anda telah tamat kerana tidak aktif. Sila log masuk semula.';
            const card = document.querySelector('.auth-card');
            if (card) card.insertBefore(msg, card.querySelector('.auth-form'));
            // Clean URL
            history.replaceState(null, '', 'login.html');
        }
    })();
    </script>
</body>
</html>